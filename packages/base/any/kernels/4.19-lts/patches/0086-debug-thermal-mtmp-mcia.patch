From 2b23bdf2c9ecde64e79d42e5f7b0c48761906257 Mon Sep 17 00:00:00 2001
From: Mykola Kostenok <c_mykolak@nvidia.com>
Date: Wed, 19 May 2021 16:47:10 +0000
Subject: [PATCH 6/6] debug: thermal-mtmp-mcia

Signed-off-by: Mykola Kostenok <c_mykolak@nvidia.com>
---
 drivers/net/ethernet/mellanox/mlxsw/core_env.c     | 5 +++++
 drivers/net/ethernet/mellanox/mlxsw/core_thermal.c | 5 +++++
 2 files changed, 10 insertions(+)

diff --git a/drivers/net/ethernet/mellanox/mlxsw/core_env.c b/drivers/net/ethernet/mellanox/mlxsw/core_env.c
index 2c7848841a9c..1fa6ea8c2cce 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/core_env.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/core_env.c
@@ -155,7 +155,12 @@ int mlxsw_env_module_temp_thresholds_get(struct mlxsw_core *core, u8 slot_index,
 	 */
 	if (module_emerg) {
 		*temp = off == SFP_TEMP_HIGH_WARN ? module_crit : module_emerg;
+		printk("New method env: Critical threshold %d, emergency threshold %d\n",
+			module_crit, module_emerg);
 		return 0;
+	} else {
+		printk("Old method env: Critical threshold %d, emergency threshold %d\n",
+			module_crit, module_emerg);
 	}
 
 	/* Read Free Side Device Temperature Thresholds from page 03h
diff --git a/drivers/net/ethernet/mellanox/mlxsw/core_thermal.c b/drivers/net/ethernet/mellanox/mlxsw/core_thermal.c
index 2d9a63b06ef4..1912ab19ab5f 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/core_thermal.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/core_thermal.c
@@ -187,6 +187,11 @@ mlxsw_thermal_module_trips_update(struct device *dev, struct mlxsw_core *core,
 							   &emerg_temp);
 		if (err)
 			return err;
+		dev_info(dev, "%s : Old method: Critical threshold %d, emergency threshold %d\n",
+			 tz->tzdev->type, crit_temp, emerg_temp);
+	} else {
+		dev_info(dev, "%s : New method: Critical threshold %d, emergency threshold %d\n",
+			 tz->tzdev->type, crit_temp, emerg_temp);
 	}
 
 	if (crit_temp > emerg_temp) {
-- 
2.20.1

